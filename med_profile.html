<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–µ–¥–∏—á–Ω–∏–π –ü—Ä–æ—Ñ—ñ–ª—å</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background:#fff; color:#b71c1c; }
h1,h2,h3 { text-align:center; color:#b71c1c; }
.container { max-width:500px; margin:20px auto; padding:20px; background:#fff0f0; border:2px solid #b71c1c; border-radius:15px; box-shadow:0 0 15px rgba(183,28,28,0.3); }
label { font-weight:bold; display:block; margin-top:10px; }
input, select { width:100%; padding:10px; margin:5px 0; border-radius:8px; border:1px solid #b71c1c; font-size:16px; }
button { width:100%; padding:12px; margin-top:10px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { opacity:0.8; }
#saveBtn { background:#b71c1c; color:white; }
#addContactBtn { background:#e53935; color:white; }
.profile { margin-top:20px; padding:20px; border-radius:15px; border:2px solid #b71c1c; background:#fff0f0; box-shadow:0 0 15px rgba(183,28,28,0.3); }
#sosBtn { background:#d32f2f; color:white; font-size:28px; padding:15px; margin-top:10px; border-radius:15px; animation: pulse 1s infinite; }
@keyframes pulse { 0% { box-shadow:0 0 10px #d32f2f; } 50% { box-shadow:0 0 25px #ff1744; } 100% { box-shadow:0 0 10px #d32f2f; } }
.sosContact { display:flex; gap:5px; flex-wrap:wrap; margin-bottom:5px; }
.sosContact input, .sosContact select { flex:1; }
footer { margin-top:20px; font-size:14px; color:#b71c1c; text-align:center; }
</style>
</head>
<body>

<h1>‚ù§Ô∏è –ú–µ–¥–∏—á–Ω–∏–π –ü—Ä–æ—Ñ—ñ–ª—å</h1>

<div class="container">
  <label>–ú–æ–≤–∞:</label>
  <select id="language">
    <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
    <option value="en">English</option>
  </select>

  <label>–ü—Ä—ñ–∑–≤–∏—â–µ:</label>
  <input type="text" id="surname">

  <label>–Ü–º'—è:</label>
  <input type="text" id="name">

  <label>–ì—Ä—É–ø–∞ –∫—Ä–æ–≤—ñ:</label>
  <select id="bloodGroup"></select>

  <label>Rh-—Ñ–∞–∫—Ç–æ—Ä:</label>
  <select id="rhFactor"></select>

  <label>–ê–ª–µ—Ä–≥—ñ—ó:</label>
  <input type="text" id="allergy">

  <label>–•—Ä–æ–Ω—ñ—á–Ω—ñ —Ö–≤–æ—Ä–æ–±–∏:</label>
  <input type="text" id="disease">

  <label>–ê–¥—Ä–µ—Å–∞ (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ):</label>
  <input type="text" id="address">

  <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –≤—ñ–∫—É:</label>
  <select id="ageCategory"></select>

  <h3>üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ SOS</h3>
  <div id="sosContacts"></div>
  <button id="addContactBtn">–î–æ–¥–∞—Ç–∏ —â–µ –∫–æ–Ω—Ç–∞–∫—Ç</button>

  <button id="saveBtn">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
</div>

<div class="profile" id="profileDisplay">
  <h2>‚ù§Ô∏è –í–∞—à –ø—Ä–æ—Ñ—ñ–ª—å:</h2>
  <div id="displayText">–ü—Ä–æ—Ñ—ñ–ª—å —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ</div>
  <button id="sosBtn">SOS</button>
</div>

<footer>–°–∞–π—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–ø–∞–Ω—ñ—ó ¬´–í–æ–∑–¥—É—Ö–∞–Ω–∏¬ª</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBMU2VUabVcXge6fw0_COv2rClMEiwwklw",
    authDomain: "med-braslet.firebaseapp.com",
    projectId: "med-braslet",
    storageBucket: "med-braslet.firebasestorage.app",
    messagingSenderId: "446417631259",
    appId: "1:446417631259:web:20f95822e062990e6da0be",
    measurementId: "G-95KSG4YBB2"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  document.addEventListener("DOMContentLoaded", async function() {
    let language = 'uk';
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('id') || "default_user";

    const translations = {
      uk:{bloodOptions:["–í–∏–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø—É –∫—Ä–æ–≤—ñ","–Ü (0)","–Ü–Ü (A)","–Ü–Ü–Ü (B)","IV (AB)"],rhOptions:["–í–∏–±–µ—Ä—ñ—Ç—å Rh","+","-"],ageOptions:["–í–∏–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –≤—ñ–∫—É","–ù–µ–ø–æ–≤–Ω–æ–ª—ñ—Ç–Ω—ñ–π","–ü–æ–≤–Ω–æ–ª—ñ—Ç–Ω—ñ–π","–õ—ñ—Ç–Ω—è –ª—é–¥–∏–Ω–∞"],relationOptions:["–ú–∞–º–∞","–¢–∞—Ç–æ","–ë—Ä–∞—Ç","–°–µ—Å—Ç—Ä–∞","–ë–∞–±—É—Å—è","–î—ñ–¥—É—Å—å","–¢—ñ—Ç–∫–∞","–î—è–¥—å–∫–æ"],addContactBtn:"–î–æ–¥–∞—Ç–∏ —â–µ –∫–æ–Ω—Ç–∞–∫—Ç",saveBtn:"–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å",sosBtn:"SOS",profileTitle:"–í–∞—à –ø—Ä–æ—Ñ—ñ–ª—å:",address:"–ê–¥—Ä–µ—Å–∞ (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)",allergy:"–ê–ª–µ—Ä–≥—ñ—ó",disease:"–•—Ä–æ–Ω—ñ—á–Ω—ñ —Ö–≤–æ—Ä–æ–±–∏",surname:"–ü—Ä—ñ–∑–≤–∏—â–µ",name:"–Ü–º'—è",sosTitle:"–ö–æ–Ω—Ç–∞–∫—Ç–∏ SOS",bloodType:"–ì—Ä—É–ø–∞ –∫—Ä–æ–≤—ñ",ageCategory:"–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –≤—ñ–∫—É"},
      en:{bloodOptions:["Select Blood Type","I (0)","II (A)","III (B)","IV (AB)"],rhOptions:["Select Rh","+","-"],ageOptions:["Select Age Category","Minor","Adult","Elderly"],relationOptions:["Mom","Dad","Brother","Sister","Grandma","Grandpa","Aunt","Uncle"],addContactBtn:"Add Another Contact",saveBtn:"Save Profile",sosBtn:"SOS",profileTitle:"Your Profile:",address:"Address (optional)",allergy:"Allergies",disease:"Chronic Diseases",surname:"Surname",name:"Name",sosTitle:"SOS Contacts",bloodType:"Blood Type",ageCategory:"Age Category"}
    };

    const bloodGroup = document.getElementById('bloodGroup');
    const rhFactor = document.getElementById('rhFactor');
    const ageCategory = document.getElementById('ageCategory');
    const sosContacts = document.getElementById('sosContacts');

    function populateSelect(select, options){
      select.innerHTML="";
      options.forEach((opt,i)=>{let option=document.createElement('option');option.text=opt;option.value=i===0?"":opt;if(i===0) option.disabled=true;select.add(option);});
    }

    function addContact(nameVal="", relationVal="", phoneVal=""){
      const t = translations[language];
      const div=document.createElement('div');
      div.className='sosContact';
      div.innerHTML=`<input type="text" class="sosName" placeholder="${t.name}" value="${nameVal}">
        <select class="sosRelation"></select>
        <input type="text" class="sosPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="${phoneVal}">`;
      sosContacts.appendChild(div);
      const select = div.querySelector('.sosRelation');
      populateSelect(select, translations[language].relationOptions);
      if(relationVal) select.value = relationVal;
    }

    function updateLanguage(){
      const t = translations[language];
      populateSelect(bloodGroup,t.bloodOptions);
      populateSelect(rhFactor,t.rhOptions);
      populateSelect(ageCategory,t.ageOptions);
      document.getElementById('addContactBtn').innerText=t.addContactBtn;
      document.getElementById('saveBtn').innerText=t.saveBtn;
      document.getElementById('sosBtn').innerText=t.sosBtn;
      document.querySelectorAll('.sosName').forEach(el=>el.placeholder=t.name);
      document.querySelectorAll('.sosPhone').forEach(el=>el.placeholder=language==='uk'?"–¢–µ–ª–µ—Ñ–æ–Ω":"Phone");
      document.querySelectorAll('.sosRelation').forEach(el=>populateSelect(el,t.relationOptions));
    }

    async function saveProfile(){
      const profile = {
        surname: document.getElementById('surname').value,
        name: document.getElementById('name').value,
        blood: bloodGroup.value,
        rh: rhFactor.value,
        allergy: document.getElementById('allergy').value,
        disease: document.getElementById('disease').value,
        address: document.getElementById('address').value,
        ageCategory: ageCategory.value,
        sos:[]
      };
      const names=document.querySelectorAll('.sosName');
      const relations=document.querySelectorAll('.sosRelation');
      const phones=document.querySelectorAll('.sosPhone');
      for(let i=0;i<names.length;i++){
        if(names[i].value && phones[i].value){profile.sos.push({name:names[i].value,relation:relations[i].value,phone:phones[i].value});}
      }
      await setDoc(doc(db,"users",userId), profile);
      displayProfile();
    }

    async function displayProfile(){
      const t = translations[language];
      const docSnap = await getDoc(doc(db,"users",userId));
      if(!docSnap.exists()) return;
      const profile = docSnap.data();
      let bloodText=profile.blood && profile.rh?profile.blood+" "+profile.rh:"";
      let addressText=profile.address?`<strong>${t.address}:</strong> ${profile.address}<br>`:"";
      let sosText=profile.sos.map(c=>`${c.name} (${c.relation}) - ${c.phone}`).join('<br>')||(language==='uk'?'–ù–µ–º–∞—î':'None');
      document.getElementById('displayText').innerHTML=`<strong>${t.surname}:</strong> ${profile.surname}<br><strong>${t.name}:</strong> ${profile.name}<br><strong>${t.bloodType}:</strong> ${bloodText}<br><strong>${t.allergy}:</strong> ${profile.allergy}<br><strong>${t.disease}:</strong> ${profile.disease}<br><strong>${t.ageCategory}:</strong> ${profile.ageCategory}<br>${addressText}<strong>${t.sosTitle}:</strong><br>${sosText}`;
    }

    function sendSOS(){
      const names=document.querySelectorAll('.sosName');
      const phones=document.querySelectorAll('.sosPhone');
      let numbers = [];
      for(let i=0;i<names.length;i++){
        if(phones[i].value) numbers.push(phones[i].value);
      }
      if(numbers.length===0){alert(language==='uk'?"–î–æ–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–∏ SOS!":"Add SOS contacts!");return;}
      if(confirm(language==='uk'?"–î–∑–≤—ñ–Ω–æ–∫ –Ω–∞ –≤—Å—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏ SOS?":"Call all SOS contacts?")){
        numbers.forEach(num=>window.location.href=`tel:${num}`);
      }
    }

    document.getElementById('language').addEventListener('change',function(){language=this.value; updateLanguage(); displayProfile();});
    document.getElementById('addContactBtn').addEventListener('click',()=>addContact());
    document.getElementById('saveBtn').addEventListener('click',saveProfile);
    document.getElementById('sosBtn').addEventListener('click',sendSOS);

    updateLanguage();
    addContact();
    displayProfile();
  });
</script>
</body>
</html>